# =================================================================
# Caddy Load Balanced Environment Configuration
# =================================================================
# Copy this file to .env.caddy and update with your values
# This file is used by docker-compose.caddy.yml
# =================================================================

# =================================================================
# DATABASE CONFIGURATION
# =================================================================

# Database Type: 'postgres' or 'mongodb'
DB_TYPE=postgres

# PostgreSQL Configuration
POSTGRES_USER=todouser
POSTGRES_PASSWORD=change_me_in_production
POSTGRES_DB=todoapp

# PostgreSQL connection string (used by backend instances)
# Format: postgresql://user:password@host:port/database?schema=public
DATABASE_URL=postgresql://todouser:change_me_in_production@postgres:5432/todoapp?schema=public

# MongoDB Configuration
MONGO_USER=admin
MONGO_PASSWORD=change_me_in_production
MONGO_DB=todoapp

# MongoDB connection string (used by backend instances)
# Format: mongodb://user:password@host:port/database?authSource=admin
MONGODB_URL=mongodb://admin:change_me_in_production@mongodb:27017/todoapp?authSource=admin

# =================================================================
# API CONFIGURATION
# =================================================================

# API Type: 'rest', 'graphql', or 'both'
API_TYPE=both

# =================================================================
# AUTHENTICATION & SECURITY
# =================================================================

# JWT Secrets (CRITICAL: Change these in production!)
# Generate with: openssl rand -base64 32
JWT_ACCESS_SECRET=your-access-secret-min-32-chars-change-in-production-abc123
JWT_REFRESH_SECRET=your-refresh-secret-min-32-chars-change-in-production-xyz789

# JWT Expiry Times
JWT_ACCESS_EXPIRY=15m      # Access token expires in 15 minutes
JWT_REFRESH_EXPIRY=7d      # Refresh token expires in 7 days

# Password Hashing
BCRYPT_ROUNDS=12           # 10-12 for dev, 12-14 for production

# =================================================================
# RATE LIMITING
# =================================================================

# Rate limit window and max requests
RATE_LIMIT_WINDOW_MS=900000        # 15 minutes in milliseconds
RATE_LIMIT_MAX_REQUESTS=500        # Max API requests per window

# =================================================================
# SESSION MANAGEMENT
# =================================================================

# Session timeout (inactive logout)
SESSION_TIMEOUT_MINUTES=5

# Session lifetime (maximum session duration)
SESSION_LIFETIME_HOURS=168         # 7 days

# Maximum concurrent sessions per user
MAX_SESSIONS_PER_USER=5

# Session cleanup schedule (cron format)
SESSION_CLEANUP_SCHEDULE="*/15 * * * *"     # Every 15 minutes

# Inactive session threshold
INACTIVE_SESSION_THRESHOLD_HOURS=24

# =================================================================
# CORS & CLIENT CONFIGURATION
# =================================================================

# CORS Origin (Frontend URL)
# Development: http://localhost:8080 (through Caddy)
# Production: https://yourdomain.com
CORS_ORIGIN=http://localhost:8080

# WebSocket Client URL (same as CORS usually)
CLIENT_URL=http://localhost:8080

# =================================================================
# LOGGING
# =================================================================

# Log Level: 'error', 'warn', 'info', 'http', 'debug'
LOG_LEVEL=info

# =================================================================
# ERROR TRACKING (Optional)
# =================================================================

# Sentry DSN for error tracking
# Leave empty to disable
SENTRY_DSN=

# =================================================================
# INSTANCE CONFIGURATION
# =================================================================

# Trusted Proxy
# Set to 'caddy' when running behind Caddy reverse proxy
TRUSTED_PROXY=caddy

# Instance IDs (managed by Docker Compose)
# backend-1: PORT=4001, INSTANCE_ID=backend-1
# backend-2: PORT=4002, INSTANCE_ID=backend-2
# backend-3: PORT=4003, INSTANCE_ID=backend-3

# =================================================================
# DEVELOPMENT VS PRODUCTION
# =================================================================

# Node Environment
# Development: Use docker-compose.caddy.yml (this file)
# Production: Use docker-compose.caddy.prod.yml (to be created in Phase 6)
NODE_ENV=production

# =================================================================
# PRODUCTION NOTES
# =================================================================
# When deploying to production, remember to:
# 
# 1. Change ALL passwords and secrets:
#    - POSTGRES_PASSWORD
#    - MONGO_PASSWORD
#    - JWT_ACCESS_SECRET
#    - JWT_REFRESH_SECRET
#
# 2. Update CORS_ORIGIN and CLIENT_URL:
#    - Use your actual domain (e.g., https://api.yourdomain.com)
#
# 3. Update Caddyfile.prod:
#    - Replace 'api.yourdomain.com' with your actual domain
#    - Replace 'your-email@example.com' with your email for Let's Encrypt
#
# 4. Increase security:
#    - Set BCRYPT_ROUNDS to 14
#    - Consider stricter rate limits
#    - Enable SENTRY_DSN for error tracking
#
# 5. Database backups:
#    - Set up automated PostgreSQL/MongoDB backups
#    - Test restore procedures
#
# 6. SSL Certificates:
#    - Caddy handles this automatically with Let's Encrypt!
#    - Just ensure DNS points to your server
#
# 7. Monitoring:
#    - Set up alerts for health check failures
#    - Monitor Caddy logs and metrics
#    - Track backend instance health
# =================================================================
